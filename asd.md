# 대장암 생존 예측 AI 프로젝트 - Windsurf 개발 계획서

## 🎯 프로젝트 개요
- **목표**: 대장암 환자 생존 예측 AI 모델 + 로컬 LLM 의료 어시스턴트
- **기술 스택**: R 100% (생존분석 전문성 활용)
- **개발 환경**: Windows 11
- **기간**: 5일 집중 개발
- **최종 산출물**: R Shiny 대시보드 + 로컬 LLM 의료 상담 시스템

## 📊 데이터 전략
- **사용 데이터**: 합성 데이터셋 (52개 변수)
- **외부 데이터**: 통합 제외 (시간 절약)
- **전처리**: tidyverse 생태계 활용

## 개발 일정

### **1. 데이터 이해 + EDA**
**목표**: 데이터 구조 파악 및 탐색적 분석
1. 데이터 로드 및 전처리 (tidyverse)
  - read_csv(), read_excel() 등으로 데이터 불러오기

2. 결측치/이상치 처리 (VIM, mice)
  - VIM::aggr() 등으로 결측치 시각화
  - mice()로 다중 대치 또는 간단 대치
  - boxplot 등으로 이상치 탐색, 필요시 수정 또는 제거

3. 핵심 EDA 시각화 (ggplot2 + plotly)
  - EDA(탐색적 데이터 분석) 
    - 목적 : 데이터의 구조, 특성, 변수 간 관계, 타깃 변수와의 연관성 등 전체적인 데이터의 모습을 파악합니다.
    - 이론적 포인트 : EDA는 단순 시각화가 아닌, 데이터의 분포, 패터, 잠재적 문제(데이터 불균형, 논리적 오류 등)을 발견하는 과정이며, 이는 모델링 전략, 변수 선택, 해석등에 큰 영향을 미침 
    - 할일
      - 변수별 분포 확인(히스토그램, 박스플롯 등)
      - 변수 간 상관관계 분석(산점도, 상관계수 등)
      - 타깃 변수(예: 생존 여부, 생존 시간)와의 연관성 시각화
      - 데이터 논리적 일관성, 품질 문제 확인

4. 기본 생존곡선 분석 (survival + survminer)
  - 이론적 의미: 
    - 생존분석의 기초로, 시간에 따른 생존 확률을 시각화하고, 그룹 간 생존율 차이를 탐색합니다. 
    - Kaplan-Meier 곡선 등은 데이터의 시간-사건 구조를 직관적으로 보여줍니다.
  - 실제 해야 할 일:
    - survival::Surv()로 생존 객체 생성
    - survfit()으로 Kaplan-Meier 곡선 추정
    - survminer::ggsurvplot()으로 생존곡선 시각화
    - 그룹별 생존율 비교, 초기 인사이트 도출

**산출물**: EDA 스크립트, 생존곡선 분석, 데이터 요약 리포트

### **Day 2: 생존분석 모델링**
**목표**: 전통적 생존분석 모델 구축
1. Cox 비례위험모델 (survival)
  - 이론적 의미: 
    - Cox 모델은 생존분석에서 가장 널리 쓰이는 반(半)매개변수적 모델로, 시간에 따른 사건 발생 위험(위험비, Hazard Ratio)에 영향을 미치는 요인을 추정합니다.
    - "비례위험 가정"— 즉, 변수의 효과(위험비)가 시간에 따라 일정하다는 가정이 핵심입니다.
  - 실제 해야 할 일:
    - survival::coxph()로 모델 적합
    - 변수별 위험비(HR) 및 신뢰구간 해석
    - 비례위험 가정 검정(schoenfeld 잔차 등)

2. 매개변수 생존모델 (flexsurv)
  - 이론적 의미:
    - 생존시간이 특정 분포(예: Weibull, Exponential 등)를 따른다고 가정하는 모델입니다.
    - 분포를 명시적으로 지정해 생존함수, 위험함수 등을 더 유연하게 추정할 수 있습니다.
  - 실제 해야 할 일:
    - flexsurv::flexsurvreg() 등으로 Weibull, Exponential 등 다양한 분포의 모델 적합
    - 각 분포별 적합도, 해석 비교

3. 생존나무 모델 (rpart, party)
  - 이론적 의미:
    - 의사결정나무(Decision Tree) 기법을 생존분석에 적용한 모델로, 변수의 비선형적, 상호작용 효과를 포착할 수 있습니다.
    - 복잡한 데이터 구조에서 해석이 용이하고, 시각적으로 분할 기준을 확인할 수 있습니다.
  - 실제 해야 할 일:
    - rpart, party 패키지로 생존나무 모델 생성
    - 트리 구조 시각화 및 규칙 해석

4. 모델 성능 비교 (survivalROC)
  - 이론적 의미:
    - 각 모델의 예측력을 비교해 실제로 어떤 모델이 사건 발생 시간 예측에 더 적합한지 평가합니다.
    - Concordance Index(C-index), 시간 종속 ROC 등 다양한 지표를 사용합니다.
  - 실제 해야 할 일:
    - survivalROC로 시간별 ROC 곡선, AUC 계산
    - Concordance Index 등으로 모델 비교
    - 예측 생존곡선, 위험도 시각화

**산출물**: 생존분석 모델 성능 비교, 위험비 시각화, 생존곡선 예측

### **Day 3: 머신러닝 모델 + 앙상블**
**목표**: 현대적 ML 모델 구축 및 앙상블
1. Random Forest (randomForest, ranger)
  - 이론적 의미:
    - Random Forest는 다수의 결정나무(Decision Tree)를 무작위로 생성해 예측을 평균화(또는 다수결)하는 앙상블 기법입니다.
    - 생존분석에서는 "Random Survival Forest"로 확장되어, 검열(censoring)된 데이터에서도 개별 환자의 생존함수나 예측 생존시간을 추정할 수 있습니다.
  - 실제 해야 할 일:
    - randomForestSRC, ranger 등 패키지로 Random Survival Forest 모델 학습
    - 변수 중요도(Feature Importance) 추출
    - 개별 환자별 예측 생존곡선 산출 및 시각화

2. XGBoost (xgboost)
  - 이론적 의미:
    - XGBoost는 부스팅(Boosting) 기반의 강력한 ML 알고리즘으로, 약한 예측기(weak learner)를 순차적으로 결합해 높은 예측력을 달성합니다.
    - 생존분석에서는 "survival:cox" 등 특화 목적함수를 사용해 사건 발생 시간 예측에 활용할 수 있습니다.
  - 실제 해야 할 일:
    - xgboost 패키지로 생존분석용 모델 학습
    - 위험도 예측, SHAP 등으로 변수 영향력 해석
    - 전체 생존곡선 예측(필요시 survXgboost 등 래퍼 활용)

3. ML 프레임워크 활용 (mlr3, tidymodels)
  - 이론적 의미:
    - mlr3, mlr3proba, tidymodels 등은 다양한 ML 모델, 생존분석 모델, 하이퍼파라미터 튜닝, 벤치마킹, 파이프라인 구축 등을 체계적으로 지원하는 R의 통합 프레임워크입니다.
  - 실제 해야 할 일:
    - mlr3proba로 생존분석용 ML 워크플로우 설계
    - 모델별 하이퍼파라미터 튜닝 및 교차검증
    - 여러 모델의 성능 일관되게 비교

4. 앙상블 모델 구축
  - 이론적 의미:
    - 앙상블(ensemble)은 서로 다른 예측 모델을 조합해 단일 모델보다 더 견고하고 일반화된 예측 결과를 얻는 기법입니다.
    - 생존분석에서도 여러 ML/통계 모델을 결합하면 단일 모델 대비 예측력과 안정성이 향상될 수 있습니다.
  - 실제 해야 할 일:
    - 여러 ML/통계 모델의 예측값을 조합(평균, 가중평균, stacking 등)
    - 앙상블 모델의 성능 평가(Concordance Index, 시간별 AUC 등)
    - 앙상블 결과 해석 및 시각화

5. AutoML 실험 (h2o)
  - 이론적 의미:
    - AutoML은 모델 선택, 하이퍼파라미터 튜닝, 앙상블까지 자동으로 수행해 최적의 예측 모델을 찾는 자동화된 ML 워크플로우입니다.
  - 실제 해야 할 일:
    - h2o 패키지로 AutoML 실행
    - 다양한 모델 자동 학습 및 성능 비교
    - 최적 모델 선정 및 결과 해석

**산출물**: ML 모델 성능 비교, Feature importance 분석, 앙상블 결과

### **Day 4: 시각화 + Shiny 대시보드**
**목표**: 인터랙티브 대시보드 구축
1. 모델 해석 (DALEX, iml, survex)
- 이론적 의미:
  - 머신러닝 및 생존분석 모델은 복잡할수록 "왜 이런 예측이 나왔는가"를 설명하기 어렵습니다.
  - DALEX, iml, survex 같은 패키지는 모델의 전체적(global)·부분적(local) 해석, 변수 중요도, 예측 근거 등을 시각화·정량화하여 사용자가 신뢰할 수 있는 결과를 제공합니다.
- 실제 해야 할 일:
  - DALEX, iml, survex로 모델의 변수 중요도(Feature Importance), Partial Dependence, SHAP 등 해석 지표 산출
  - 개별 환자/케이스별로 예측 결과의 근거 제시
  - 해석 결과를 시각화하여 의료진이 쉽게 이해할 수 있도록 제공

2. 고급 시각화 (survminer + ggplot2)
- 이론적 의미:
  - 생존분석 결과(예: Kaplan-Meier 곡선, 위험도 곡선 등)를 직관적으로 보여주는 것은 의사결정과 소통에 매우 중요합니다.
  - survminer 패키지는 ggplot2 기반으로, 논문/보고서 수준의 생존곡선, 위험도, p-value, 위험 집단 수 등 다양한 정보를 한 번에 시각화할 수 있습니다.
- 실제 해야 할 일:
  - ggsurvplot() 등으로 생존곡선, 위험도, 그룹별 비교 시각화
  - 변수별, 그룹별, 시간별 다양한 시각화 생성
  - p-value, 위험 집단 수 등 추가 정보 표시

3. Shiny 대시보드 기본 구조
- 이론적 의미:
  - R Shiny는 R 분석 결과를 웹 기반 대시보드로 인터랙티브하게 제공하는 프레임워크입니다.
  - 사용자는 직접 변수/조건을 조작하며 실시간으로 결과(예: 생존곡선, 위험도, 변수 영향 등)를 확인할 수 있습니다.
- 실제 해야 할 일:
  - Shiny UI(사용자 입력, 탭, 슬라이더 등) 설계
  - Server 로직(데이터 필터링, 모델 예측, 시각화 등) 구현
  - 입력값에 따라 실시간으로 그래프/표/해석 결과 업데이트
  - 직관적이고 반응성 높은 레이아웃 설계

4. 인터랙티브 생존곡선 및 위험도 시각화
- 이론적 의미:
  - 단순 정적 그래프가 아니라, 사용자가 조건(예: 그룹, 변수 값 등)을 바꾸면 즉시 생존곡선·위험도·예측 결과가 갱신되는 인터랙티브 시각화는 실제 임상 의사결정 지원에 매우 효과적입니다.
- 실제 해야 할 일:
  - Shiny 입력값(예: 환자 정보, 그룹 선택 등)에 따라 실시간 생존곡선, 위험도 등 업데이트
  - plotly 등으로 마우스 오버, 확대/축소 등 인터랙티브 기능 추가
  - 다양한 조건별 결과 비교 및 해석 제공

**산출물**: 완성된 Shiny 대시보드 (LLM 제외), 시각화 모음

### **Day 5: 로컬 LLM 통합 + 최종 완성**
**목표**: LLM 의료 상담 시스템 통합
1. 로컬 LLM 설치 (ollama for Windows)
- 이론적 의미:
  - LLM(Large Language Model)을 로컬 환경에 설치해, 인터넷 연결 없이도 민감한 의료 데이터를 안전하게 처리할 수 있습니다.
  - 오픈소스 ollama는 Windows에서 손쉽게 LLM(예: llama2:7b-chat 등)을 구동할 수 있게 해줍니다.
- 실제 해야 할 일:
  - Windows 환경에 ollama 설치
  - 의료 특화 LLM 모델(예: llama2:7b-chat) 다운로드 및 구동
  - 로컬 API 서버(기본: localhost:11434) 실행

2. 의료 특화 프롬프트 개발
- 이론적 의미:
  - LLM의 답변 품질은 프롬프트(질문/지시문)의 설계에 크게 좌우됩니다.
  - 의료 상담에 특화된 프롬프트를 설계하면, 환자별 상황에 맞는 정확하고 신뢰성 있는 답변을 유도할 수 있습니다.
- 실제 해야 할 일:
  - 환자 정보, 예측 결과, 의료 상황을 LLM에 효과적으로 전달할 수 있는 프롬프트 작성
  - 예시: “이 환자의 생존 예측 결과와 주요 위험 요인을 바탕으로, 환자와 보호자에게 설명해 주세요.”
  - 프롬프트 테스트 및 개선

3. Shiny 앱에 채팅 기능 통합
- 이론적 의미:
  - Shiny 앱과 LLM을 연동하면, 사용자가 입력한 질문이나 환자 정보를 바탕으로 실시간 AI 상담이 가능합니다.
  - httr, jsonlite 등 R 패키지로 HTTP API를 호출해 LLM과 통신합니다.
- 실제 해야 할 일:
  - Shiny UI에 채팅 입력/출력 창 구현
  - httr::POST() 등으로 로컬 LLM API 호출
  - 환자별 예측 결과와 상담 내용을 연동

실시간 질문/응답 처리 로직 작성

4. 환자별 맞춤 의료 상담 시스템
- 이론적 의미:
  - 단순 정보 제공이 아닌, 각 환자의 예측 결과와 특성을 반영한 맞춤형 상담이 핵심입니다.
  - LLM이 생존분석 결과(예: 생존확률, 위험요인 등)를 해석해 환자·의료진에게 설명하고, 추가 질문에도 대응할 수 있습니다.
- 실제 해야 할 일:
  - 환자별 예측 결과를 LLM 프롬프트에 자동 반영
  - 상담 내역 저장 및 요약 기능(필요시)
  - 의료진/환자 모두가 쉽게 이해할 수 있는 답변 제공

5. 최종 테스트 및 문서화
- 이론적 의미:
  - 모든 기능이 정상 동작하는지 검증(테스트)하고, 사용법·구성·의사결정 근거 등을 문서화해 재현성과 신뢰성을 확보합니다.
- 실제 해야 할 일:
  - 대시보드 및 LLM 상담 기능 통합 테스트
  - 다양한 시나리오(환자 정보, 질문 등)로 QA
  - 사용자 매뉴얼, 설치/운영 문서, 코드 주석 등 작성

GitHub 등 버전관리 시스템에 최종 산출물 정리

**산출물**: 완전한 의료 AI 대시보드, 사용자 매뉴얼, GitHub 리포지토리

## 🛠 핵심 R 패키지 스택

### 데이터 처리 & 분석
- `tidyverse`: 데이터 조작 및 시각화
- `janitor`: 데이터 정리
- `VIM`, `mice`: 결측치 처리

### 생존분석 (R의 강점)
- `survival`: Cox 회귀, Kaplan-Meier
- `survminer`: 생존곡선 시각화
- `flexsurv`: 매개변수 생존모델
- `rms`: 고급 회귀 모델링

### 머신러닝
- `randomForest`, `ranger`: 랜덤 포레스트
- `xgboost`: 그래디언트 부스팅
- `mlr3`, `tidymodels`: 현대적 ML 프레임워크
- `h2o`: AutoML

### 시각화 & 대시보드
- `ggplot2`, `plotly`: 시각화
- `shiny`, `shinydashboard`: 웹 애플리케이션
- `DT`: 인터랙티브 테이블

### 모델 해석 & LLM 연동
- `DALEX`, `iml`: 모델 해석
- `httr`, `jsonlite`: LLM API 통신

## 💻 Windows 11 개발 환경 설정

### R 환경 설정
```r
# 기본 설정
options(stringsAsFactors = FALSE)
options(scipen = 999)  # 과학적 표기법 비활성화
options(max.print = 1000)  # 출력 개수 제한

# 데이터 처리 옵션
options(tidyverse.quiet = TRUE)
options(VIM.showProgressBar = TRUE)

# 모델링 옵션
options(na.action = na.omit)
options(warn = 1)  # 경고 메시지 표시
```

### 패키지 의존성 관리
```r
# 설치할 패키지 목록
packages <- c(
  "tidyverse", "janitor", "VIM", "mice",  # 데이터 처리
  "survival", "survminer", "flexsurv", "rms",  # 생존분석
  "randomForest", "ranger", "xgboost", "mlr3", "tidymodels",  # ML
  "shiny", "shinydashboard", "DT", "plotly",  # 대시보드
  "DALEX", "iml", "httr", "jsonlite", "renv"  # 모델 해석 & LLM
)

# 설치되지 않은 패키지만 설치
install_if_missing <- function(p) {
  if (!requireNamespace(p, quietly = TRUE)) {
    install.packages(p, dependencies = TRUE)
  }
}

invisible(lapply(packages, install_if_missing))

# renv 초기화 및 패키지 버전 고정
renv::init()
renv::snapshot()
```

### R 환경
- R 4.3+ 설치
- RStudio 최신 버전
- renv 패키지 의존성 관리 사용

### 로컬 LLM (ollama)
- Windows용 ollama 설치
- 의료 특화 모델 다운로드 (llama2:7b-chat)
- 로컬 API 서버 구동 (localhost:11434)

## 🎁 최종 산출물

### GitHub 리포지토리 구조
```
암환자_생존율예측/
├── README.md
├── R/
│   ├── 01_data_preparation.R
│   ├── 02_exploratory_analysis.R
│   ├── 03_survival_modeling.R
│   ├── 04_ml_models.R
│   ├── 05_model_evaluation.R
│   └── shiny_app/
│       ├── ui.R
│       ├── server.R
│       ├── global.R
│       └── llm_functions.R
├── data/
├── models/
├── plots/
├── DESCRIPTION
└── renv/  # 패키지 의존성 관리
```

### Shiny 앱 주요 기능
1. **환자 정보 입력**: 다중 모델 생존확률 예측
2. **생존분석 시각화**: 인터랙티브 Kaplan-Meier 곡선
3. **모델 성능 대시보드**: ROC 곡선, Feature Importance
4. **AI 의료 상담**: 로컬 LLM 기반 맞춤 상담

### 로컬 LLM 의료 상담 시스템
- 환자별 맞춤 설명
- 실시간 질의응답
- 의료 전문 프롬프트 활용
- 생존율 해석 및 치료 권장사항

## 💡 프로젝트 차별화 포인트

### 1. 도메인 전문성
의료 통계 분야의 표준 도구인 R을 활용한 생존분석 전문 시스템

### 2. 기술적 혁신
- **로컬 LLM**: 비용 효율성 + 데이터 보안
- **End-to-End R**: 일관된 워크플로우
- **실무 적용**: 의료진이 실제 사용 가능한 인터페이스

### 3. 완전한 솔루션
데이터 분석 → 모델링 → 시각화 → 대시보드 → AI 상담까지 하나의 언어로 구현

## ⚡ 개발 효율성 전략

### 시간 절약 방법
- 외부 데이터 통합 제외
- 검증된 R 패키지 활용
- 기본 하이퍼파라미터 사용
- 단일 언어 사용으로 환경 설정 간소화

### 집중 포인트
- 생존분석 전문성 어필
- 로컬 LLM 의료 상담 시스템 (핵심 차별화)
- 직관적 사용자 인터페이스
- 명확한 의료적 인사이트 도출

## 🎯 성공 기준

1. **기능적 완성도**: 모든 모델이 정상 작동하는 Shiny 앱
2. **사용자 경험**: 의료진이 직관적으로 사용할 수 있는 인터페이스
3. **기술적 혁신**: 로컬 LLM과 생존분석 모델의 seamless 통합
4. **포트폴리오 가치**: 취업/이직 시 차별화된 강점 어필

---

**R의 생존분석 전문성과 로컬 LLM의 혁신성을 결합한 차별화된 의료 AI 포트폴리오를 5일만에 완성합니다.**