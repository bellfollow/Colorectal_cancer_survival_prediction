
# 상관관계 분석
- EDA 분석을 실행하기 위해 일반 02_exploratory_analysis.R 파일을 실행한다.
- 해당 파일에서 일단 파일의 이름을 정확하게 알아야 하기에 아래 코드를 출력한다.
```R
cat("\n=== 데이터 기본 정보 ===\n")
cat("데이터 차원:", dim(data), "\n")
cat("변수명:\n")
print(names(data))
```
- 주요 분석 방법은 임상 변수들 간의 상관관계 분석, 병기와 생존의 관련성 분석, 수술 여부와 생존의 관련성 분석 
- 결과로만 따지면 이렇다 할만한 연관성을 찾기가 힘들었음 
## 임상 변수들 간의 상관관계 분석
- 연령,신장게측,생존 여부에 관해 상관관계 분석을 했을 때, 모두 상관관계가 거의 없음을 확인할 수 있었다. 
    - 추가로 찾아보니 애초에 정말 상관관계가 없다고 알려져 있음

## 병기와 생존의 관련성 분석
- 병기와 생존의 관련성 분석을 했을 때, p-value < 0.05에 해당 하는 값이 전혀 없음을 확인함

## 수술 여부와 생존의 관련성 분석
- 수술 여부와 생존의 관련성 분석을 했을 때, p-value < 0.05에 해당 하는 값이 전혀 없음을 확인함

## 생존 분석
- 생존 분석을 했을 때, p-value < 0.05에 해당 하는 값이 전혀 없음을 확인함


# 처음부터
- 데이터 전처리의 문제라 생각하여 처음부터 다시 하기로 했다. 기존 SEER데이터셋을 사용한 한국의 논문이 있기에 참고할 수 있었다.
- [논문](https://www.nature.com/articles/s41598-025-95385-0)
- 논문에서 50세 이전 암진단 환자의 경우 EOCRC로 분류하고, 50세 이후 암진단 환자의 경우 LOCRC로 분류했다.
- 해당 데이터셋의 비율은 3:7로 EOCRC와 LOCRC로 분류한다. 논문에서도 같다.
- 이후 확인해보니 논문에서는 18세 이상 환자만을 대상으로 분석했다. 이전에는 결측치만 제외하고 분석했다.
- 추가적으로 확인하니 모든 요소가 0이거나 1인 변수 검사를 해보니 모두 0인 변수 4개, [1] "병기STAGE.N2a." "병기STAGE.N2b." "병기STAGE.N3a." "병기STAGE.N3b." 가 있어 모두 삭제하기로함, 1은 없었음
- EOCRC와 LOCRC로 분류한 데이터를 학습 데이터와 테스트 데이터로 분리하여 저장 


## 대장암 임상 데이터 변수 정리
|변수명|설명|값 예시/코드|
|---|---|---|
|AGE|진단 시 연령|67|
|조직학적 진단명 (mucinous 등)|각 조직형별 진단 여부|0=아니오, 1=예|
|병기(STAGE) 정보 (Tis, T1 등)|각 병기별 진단 여부|0=아니오, 1=예|
|Type.of.Drink|음주 종류|1=맥주, 2=소주, 3=양주, 99=기타|
|Smoke|흡연 여부|0=비흡연, 1=현재흡연, 2=과거흡연|
|Height|신장(cm)|170.1|
|Weight|체중(kg)|64.5|
|EGFR|면역병리 EGFR 검사 결과|1=negative, 2=positive, 99=해당없음|
|MSI, KRASMUTATION_EXON2, KRASMUTATION, NRASMUTATION, BRAF_MUTATION|분자병리 검사 결과|1=not detected, 2=detected, 99=해당없음|
|Operation|대장암 수술 여부|0=아니오, 1=예|
|Chemotherapy|항암제 치료 여부|0=아니오, 1=예|
|Radiation.Therapy|방사선 치료 여부|0=아니오, 1=예|
|Death|사망 여부|0=아니오, 1=예|
|Survival.period|암 진단 후 생존 일수|267 (days)|
|cancer_type|암 유형(EOCRC, LOCRC)|"EOCRC", "LOCRC"|

## 줄이기
- 데이터셋 변수 줄이기로는 병기를 통합하는 방법 밖엔 없음 논문에서는 TMN으로 줄였지만 우리는 T,M,N으로 줄이리고함
- 결측치 50퍼 넘어가는건 삭제하려 했으나 M_stage가 날아가는것이 문제임, M_stage만 남길지 고민임
    - 국제 표준으로 병기 부분은 남기는게 옳다함 M도 날아가고 N도 날아가게 생겼으니 병기 부분은 예외로 두는게 옳음
## 단변량 분석
- 각 임상 변수와 생존(사망여부와 생존기간)과의 상관 관계를 확인하기 위해 단변량 분석을 수행한다.
- 관련성 적은 변수는 모두 삭제할것


### 단변량 분석 결과
- 값이 쓰레기 처럼 나왔다. 
1. M_stage의 값이 M1과 NA로 표시되는데 이것을 하나의 병리값이 나오는것으로 판단한다
2. N_stage도 똑같다
3. 생각없이 99를 NA로 바꿨다 데이터를 다시 뜯어보니 결론이 났다.
    - 분자병리 검사 → 99를 NA(결측치)로 처리 (MSI, KRASMUTATION, NRASMUTATION, BRAF_MUTATION)
    - 이유:
        - 이들은 선택적 검사로 모든 환자에게 시행되지 않음
        - 99="해당없음"은 실제로 검사를 시행하지 않음을 의미
        - 검사 미시행과 음성/양성 결과는 완전히 다른 정보
        - 논문에서도 분자병리 마커는 중요한 예후 인자로 사용되므로 정확한 처리 필요
4. 99를 모두 0으로 바꾸려고보니 음주 부분은 0으로 바꿔도 문제가 없을것 같았지만 나머지가 문제였다.
- 논문 기반으로 진행하는 것이라 논문 기중에 맞추고 NA로 바꾸고 다중대치법 적용함함

## 단변량 분석 결과
```
===  EOCRC 그룹 단변량 Cox 회귀 분석 ===

[전체 변수 분석 결과]


              Variable                                                             HR   CI_lower   CI_upper   p_value
------------  --------------------------------------------------------------  -------  ---------  ---------  --------
lower .952    조직학적진단명.코드.설명.signet.ring.cell.                        1.284      1.021      1.614     0.033
lower .957    조직학적진단명.코드.설명.Neoplasm.malignant.                      1.184      0.943      1.485     0.145
lower .9511   체중측정값.Weight.                                                0.995      0.989      1.002     0.152
lower .954    조직학적진단명.코드.설명.carcinoide.tumor.                        1.165      0.924      1.470     0.197
lower .9519   항암제.치료.여부.Chemotherapy.                                    0.849      0.660      1.092     0.202
lower .953    조직학적진단명.코드.설명.adenocarcinoma.                          0.882      0.711      1.094     0.253
lower .958    음주종류.Type.of.Drink.                                           1.045      0.968      1.127     0.262
lower .9512   면역병리EGFR검사코드.명.EGFR.                                     0.915      0.775      1.081     0.297
lower .9517   분자병리BRAF_MUTATION검사결과코드.명.BRAF_MUTATION.               0.935      0.789      1.107     0.434
lower .9523   M_stage                                                           0.937      0.793      1.107     0.442
lower .951    조직학적진단명.코드.설명.mucinous.                                1.092      0.870      1.369     0.449
lower .9515   분자병리KRASMUTATION검사결과코드.명.KRASMUTATION.                 0.948      0.803      1.120     0.531
lower .9518   대장암.수술.여부.Operation.                                       0.945      0.781      1.143     0.560
lower .956    조직학적진단명.코드.설명.squamous.cell.carcinoma.                 1.061      0.829      1.357     0.638
lower .9510   신장값.Height.                                                    1.002      0.994      1.009     0.650
lower .9514   분자병리KRASMUTATION_EXON2검사결과코드.명.KRASMUTATION_EXON2.     1.034      0.875      1.222     0.692
lower .959    흡연여부.Smoke.                                                   1.016      0.905      1.142     0.783
lower .9516   분자병리NRASMUTATION검사결과코드.명.NRASMUTATION.                 1.019      0.863      1.204     0.824
lower .9522   N_stage                                                          -0.151      0.809      1.168     0.860
lower .9520   방사선치료.여부.Radiation.Therapy.                                1.015      0.805      1.281     0.899
lower .955    조직학적진단명.코드.설명.Neuroendocrine.carcinoma.                1.012      0.789      1.298     0.927
lower .9513   분자병리MSI검사결과코드.명.MSI.                                   0.997      0.909      1.094     0.951
lower .95     진단시연령.AGE.                                                   1.000      0.990      1.011     0.954
lower .9521   T_stage                                                           0.032      0.819      1.316     1.038

[유의미한 변수 (p < 0.05)]


             Variable                                         HR   CI_lower   CI_upper   p_value
-----------  -------------------------------------------  ------  ---------  ---------  --------
lower .952   조직학적진단명.코드.설명.signet.ring.cell.    1.284      1.021      1.614     0.033

유의미한 범주형 변수에 대한 생존곡선을 그립니다...
> # LOCRC 그룹 분석
> locrc_results <- perform_univariate_analysis(locrc_data, "LOCRC")

===  LOCRC 그룹 단변량 Cox 회귀 분석 ===

[전체 변수 분석 결과]


              Variable                                                            HR   CI_lower   CI_upper   p_value
------------  --------------------------------------------------------------  ------  ---------  ---------  --------
lower .9511   체중측정값.Weight.                                               1.004      1.000      1.008     0.045
lower .955    조직학적진단명.코드.설명.Neuroendocrine.carcinoma.               1.156      0.986      1.354     0.074
lower .9513   분자병리MSI검사결과코드.명.MSI.                                  0.952      0.893      1.013     0.122
lower .954    조직학적진단명.코드.설명.carcinoide.tumor.                       1.128      0.960      1.327     0.144
lower .95     진단시연령.AGE.                                                  0.996      0.991      1.001     0.156
lower .9523   M_stage                                                          1.085      0.969      1.215     0.157
lower .9519   항암제.치료.여부.Chemotherapy.                                   1.100      0.942      1.286     0.228
lower .9518   대장암.수술.여부.Operation.                                      0.928      0.815      1.055     0.254
lower .958    음주종류.Type.of.Drink.                                          1.030      0.977      1.086     0.272
lower .9510   신장값.Height.                                                   1.003      0.998      1.008     0.275
lower .9516   분자병리NRASMUTATION검사결과코드.명.NRASMUTATION.                1.057      0.944      1.183     0.337
lower .9517   분자병리BRAF_MUTATION검사결과코드.명.BRAF_MUTATION.              1.039      0.928      1.165     0.506
lower .953    조직학적진단명.코드.설명.adenocarcinoma.                         1.052      0.900      1.231     0.524
lower .9514   분자병리KRASMUTATION_EXON2검사결과코드.명.KRASMUTATION_EXON2.    0.967      0.864      1.083     0.566
lower .9520   방사선치료.여부.Radiation.Therapy.                               1.042      0.890      1.220     0.608
lower .959    흡연여부.Smoke.                                                  1.020      0.941      1.105     0.632
lower .9512   면역병리EGFR검사코드.명.EGFR.                                    0.974      0.870      1.090     0.641
lower .9515   분자병리KRASMUTATION검사결과코드.명.KRASMUTATION.                1.025      0.916      1.147     0.667
lower .956    조직학적진단명.코드.설명.squamous.cell.carcinoma.                1.029      0.870      1.217     0.740
lower .952    조직학적진단명.코드.설명.signet.ring.cell.                       0.976      0.828      1.150     0.771
lower .957    조직학적진단명.코드.설명.Neoplasm.malignant.                     1.016      0.861      1.200     0.847
lower .951    조직학적진단명.코드.설명.mucinous.                               1.015      0.867      1.189     0.851
lower .9521   T_stage                                                          0.009      0.766      1.059     0.901
lower .9522   N_stage                                                          0.080      0.940      1.211     1.083

[유의미한 변수 (p < 0.05)]


              Variable                 HR   CI_lower   CI_upper   p_value
------------  -------------------  ------  ---------  ---------  --------
lower .9511   체중측정값.Weight.    1.004          1      1.008     0.045

```
- 우리나라 대장암의 발병률 양상과 위험인자에 대한 연구 라는 이름의 [우리나라 대장암의 발병률 양상과
위험인자에 대한 연구](https://repository.nhimc.or.kr/bitstream/2023.oak/208/2/2017-20-004.pdf) 
    - "앞서 분석한 단변량 분석결과에서 대장암 발생에 유의한 요인으로 선정된 변수들과 기존문헌에서 조사된 요인들을 모두 혼합하여 다변량 분석을 실시하였다." 를 기준으로 진행하겠다.

- 일단은 다변량도 시도해보겠다

## 다변량 분석
- 단변량 분석은 ```surv(생존일수 ,사망여부) ~ 하나의 변수``` 이런식으로 해결됐다면
- 다변량은 ```surv(생존일수 ,사망여부) ~ 여러개의 변수``` 이런식으로 해결된다
```
 [1] "순번.No."
 [2] "진단시연령.AGE."
 [3] "조직학적진단명.코드.설명.mucinous."
 [4] "조직학적진단명.코드.설명.signet.ring.cell."
 [5] "조직학적진단명.코드.설명.adenocarcinoma."
 [6] "조직학적진단명.코드.설명.carcinoide.tumor."
 [7] "조직학적진단명.코드.설명.Neuroendocrine.carcinoma."
 [8] "조직학적진단명.코드.설명.squamous.cell.carcinoma."
 [9] "조직학적진단명.코드.설명.Neoplasm.malignant."
[10] "음주종류.Type.of.Drink."
[11] "흡연여부.Smoke."
[12] "신장값.Height."
[13] "체중측정값.Weight."
[14] "면역병리EGFR검사코드.명.EGFR."
[15] "분자병리MSI검사결과코드.명.MSI."
[16] "분자병리KRASMUTATION_EXON2검사결과코드.명.KRASMUTATION_EXON2."
[17] "분자병리KRASMUTATION검사결과코드.명.KRASMUTATION."
[18] "분자병리NRASMUTATION검사결과코드.명.NRASMUTATION."
[19] "분자병리BRAF_MUTATION검사결과코드.명.BRAF_MUTATION."
[20] "대장암.수술.여부.Operation."
[21] "항암제.치료.여부.Chemotherapy."
[22] "방사선치료.여부.Radiation.Therapy."
[23] "사망여부.Death."
[24] "암진단후생존일수.Survival.period."
[25] "T_stage"
[26] "N_stage"
[27] "M_stage"
[28] "cancer_type"
```
- 다변량에서 제외할 변수는 순번, cancer_type 이다. 2개 빠짐
- 진단명도 필요하다 생각함, 단변량에서 유의미한 변수였음, EOCRC에서는 유일하게 p < 0.05를 만족하는 변수였고, LOCRC에서는 아쉽게도 만족하지 못한 변수였다. 외국의 사레에서는 보수적으로 P < 0.25까지 포함한다고 친다면 (현재 프로젝트의 데이터 수의 부족이므로)
- EOCRC에서는 
```
lower .952    조직학적진단명.코드.설명.signet.ring.cell.                        1.284      1.021      1.614     0.033
lower .957    조직학적진단명.코드.설명.Neoplasm.malignant.                      1.184      0.943      1.485     0.145
lower .9511   체중측정값.Weight.                                                0.995      0.989      1.002     0.152
lower .954    조직학적진단명.코드.설명.carcinoide.tumor.                        1.165      0.924      1.470     0.197
lower .9519   항암제.치료.여부.Chemotherapy.                                    0.849      0.660      1.092     0.202
```
- 가 해당될 것이고
- LOCRC에서는 
```
              Variable                                                            HR   CI_lower   CI_upper   p_value
------------  --------------------------------------------------------------  ------  ---------  ---------  --------
lower .9511   체중측정값.Weight.                                               1.004      1.000      1.008     0.045
lower .955    조직학적진단명.코드.설명.Neuroendocrine.carcinoma.               1.156      0.986      1.354     0.074
lower .9513   분자병리MSI검사결과코드.명.MSI.                                  0.952      0.893      1.013     0.122
lower .954    조직학적진단명.코드.설명.carcinoide.tumor.                       1.128      0.960      1.327     0.144
lower .95     진단시연령.AGE.                                                  0.996      0.991      1.001     0.156
lower .9523   M_stage                                                          1.085      0.969      1.215     0.157
lower .9519   항암제.치료.여부.Chemotherapy.                                   1.100      0.942      1.286     0.228
```
- 일것이다.

- 다변량 분석을 시행해 p < 0.25 로 다시 진행할지, 아님 독립 예후인자로 뽑을지 결정해보자

